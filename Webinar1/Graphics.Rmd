---
title: "Maryland Ozone Midnight 10/28/19 to Noon 10/29/19"
author: "Jenny St. Clair, GIS Analyst, MARAMA"
output: html_document
---
Thanks to Joel Dreessen from MDE for helping me make sense of this monitoring data!

### Purpose: to make a graphic describing ozone activity at all monitoring sites in Maryland over a 36 hour period (midnight 10/28/19 to noon 10/29/19).

## 1. Load packages.
```{r Packages, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(here)

```

## 2. Make sure you're working in your designated project folder. 
If you have an R Project and your data in the same folder as this script, you should be in good shape, but it's always good to check! This is the only time we need to use the here package.
```{r}
here()
```

## 3. Read in data. 
Data source: https://www.airnowtech.org/ 
```{r message=FALSE, warning=FALSE}
data <- read.csv("MD_o3_1029_tidy.csv")

```


## 4. Some data prep (we'll dive into specifics later but for now just copy, paste, and run.)
```{r message=FALSE, warning=FALSE}
data <- data %>% select (-c(X,time))

data$Site.AQS.split <- as.character(data$Site.AQS)
data<- data %>% separate(Site.AQS.split, c("State.FIPS", "County.AQS"), 2)
data <- data %>% separate(County.AQS, c("County.FIPS", "Site"), 3)

data$Site.AQS <- as.factor(data$Site.AQS)
data$State.FIPS <- as.factor(data$State.FIPS)
data$County.FIPS <- as.factor(data$County.FIPS)
data$Method <- as.factor(data$Method)

data <- data %>% filter(State.FIPS == "24")


data$date <- data$date %>% 
  as_datetime() 

str(data)
```

### 5. Make a scatterplot.
The two main functions necessary for a ggplot graphic are the ggplot() and geom_point() functions (connected by a "+"). Data is fed into the ggplot(). There must be an aes() function (short for aesthetic) inside one of these, and this is where you specify which variables you'd like to examine. Just like in cartesian coordinates, aes() will look for x and then y.The geom_...() function specifies the geometry we'd like to use. Other commonly used geometries are geom_col() and geom_line().
This plot tells us the extent of our data, which is helpful, but we need to know more. This dataset also includes the site number that each ozone value was recorded at, as well as the method used to record it.

TLDR: ggplot requires data fed into ggplot(), a geometry specified by geom_...(), and x/y variables specified inside aes(), which goes inside either ggplot() or geom_...().
```{r}
data %>% 
  ggplot(aes(x = date, y = o3)) +
  geom_point() 
```

## 6. Add color.
If we want to see which point came from which site, we can do so by using color. This means adding another variable aesthetic, so it goes inside an aes() function.

Side note: the last argument on this plot adds a theme to the plot. There are many different themes you can use, and I HIGHLY recommend using one anytime you share a plot. It is an easy way to make your work look sharp. I recommend theme_minimal(), theme_light(), theme_bw(), or theme_void(). Be sure to take a few minutes to try these out and pick your favorite! Looks matter.
```{r}
data %>% 
  ggplot(aes(x = date, y = o3)) +
  geom_point(aes(color = Site.AQS)) +
  theme_bw()

```


# Exercise 1: change from point to line
#### Adding color to the points is helpful but it's hard to see what's going on at each monitor. Change the geometry from geom_point to geom_line in the last chunk of code.
```{r, eval = FALSE}

data %>% 
  ggplot(aes(x = date, y = o3)) +
  geom_point(aes(color = Site.AQS))+
  theme_bw()

```


##  7. Add facet_wrap()
#### Now the plot shows individual monitor changes over time, but it's too busy to make sense of it. We'll add facet_wrap(~Site.AQS) to the plot.
```{r}
data %>% 
  ggplot(aes(x = date, y = o3)) +
  geom_line(aes(color = Site.AQS)) +
  theme_bw()+
  facet_wrap(~Site.AQS)
```


## 8. Rotate labels, remove legend.
#### There are a number of issues here. The worst one is the labels on the x-axis. Let's rotate those by 90 degrees. Another one is the legend which is redundant with the grid headers. So let's ditch that too.
```{r}
data %>% 
  ggplot(aes(x = date, y = o3))+
  geom_line(aes(color = Site.AQS))+
  theme_bw()+
  facet_wrap(~Site.AQS)+
  theme(axis.text.x = element_text(angle = 90), legend.position = "")
```

## 9. Increase the line size.
```{r}
data %>% 
  ggplot(aes(x = date, y = o3))+
  geom_line(aes(color = Site.AQS), size = 1.2)+
  theme_bw()+
  facet_wrap(~Site.AQS)+
  theme(axis.text.x = element_text(angle = 90), legend.position = "")

```

## 10. Add a title, fix up x and y labels.
```{r}
data %>% 
  ggplot(aes(x = date, y = o3))+
  geom_line(aes(color = Site.AQS), size = 1.2)+
  theme_bw()+
  facet_wrap(~Site.AQS)+
  theme(axis.text.x = element_text(angle = 90), legend.position = "")+
  labs(title = "Hourly Ozone at Maryland Sites over 36 Hours", x = "Date/Time", y = "Ozone PPB")

```

# Exercise 2: 

### 1. Change the line color to Method instead of Site.AQS (this is case-sensitive).
### 2. Add a subtitle that says "Method 47 = Ultraviolet Photometry, Method 87 = Ultraviolet Radiation Absorption". 
### 3. Bring the legend back.

Hint: you can add the subtitle inside the labs() function.

Hint: Look back to where we got rid of the legend.

```{r,include=FALSE, eval=FALSE}
data %>% 
  ggplot(aes(x = date, y = o3)) +
  geom_line(aes(color = Method), size = 1.2) +
  theme_bw()+
  facet_wrap(~Site.AQS)+
  theme(axis.text.x = element_text(angle = 90))+
  labs( title = "Hourly Ozone at Maryland Sites over 36 Hours", 
        subtitle = "Method 47 = Ultraviolet Photometry, Method 87 = Ultraviolet Radiation Absorption")

```

# Homework 1
You may want to watch this tour of R Markdown (which includes air quality examples!): https://www.youtube.com/watch?v=DNS7i2m4sB0 

### 1. Open the R Markdown script in the Homework 1 folder. The script in the folder works on the Iris dataset that comes with R. 
### 2. Change it to use the same data we used here. The data prep is included. 
### 3. Let the histogram show the frequency of different ozone values in the dataset (ozone on the x-axis, no y-axis variable necessary). 
### 4. Change the number of bins (in geom_histogram()) to 20, then try 40.
### 5. Use the labs() function to add a title, a subtitle with your name, and rename the x-axis "Ozone."


# For fun: 
### 1. Try applying different themes to your plot. 
https://www.datanovia.com/en/blog/ggplot-themes-gallery/  

### 2. Use the function plotly::ggplotly() to make the graphic interactive.
https://plot.ly/ggplot2/  

### 3. See what happens if you put <fill = Site.AQS> in the aes() function inside geom_histogram().


Remember, when you run into errors and weird results, don't spend too much time scratching your head. If you can't think of a solution after a couple minutes, google it! StackExchange/StackOverflow is your friend too. If you are really stuck, shoot me an email.

https://ggplot2.tidyverse.org/reference/geom_histogram.html 
```{r, eval=FALSE, include = FALSE}
plot <- data %>% 
  ggplot(aes(o3)) +
  geom_histogram(bins = 40)

plot

library(plotly)
ggplotly(plot)
```


#### Tip: ggplot is based off of the grammar of graphics. Follow this link if you'd like to learn more about this: https://byrneslab.net/classes/biol607/readings/wickham_layered-grammar.pdf 